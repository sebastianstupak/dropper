plugins {
    // Enable automatic Java toolchain download
    id("org.gradle.toolchains.foojay-resolver-convention") version "0.8.0"
}

rootProject.name = "{{modId}}"

// Dynamically discover version-loader combinations
val versionsDir = file("versions")
val mcVersions = versionsDir.listFiles()
    ?.filter { it.isDirectory && it.name != "shared" }
    ?.map { it.name }
    ?: emptyList()

val loaders = listOf("fabric", "forge", "neoforge")

// Create subproject for each combination
mcVersions.forEach { version ->
    loaders.forEach { loader ->
        val projectName = "$version-$loader"
        include(projectName)

        val projectDir = file("build-temp/$projectName")
        project(":$projectName").projectDir = projectDir

        projectDir.mkdirs()
        val buildFile = File(projectDir, "build.gradle.kts")
        if (!buildFile.exists()) {
            buildFile.writeText("""
                plugins {
                    id("ModLoaderPlugin")
                }
            """.trimIndent())
        }
    }
}
